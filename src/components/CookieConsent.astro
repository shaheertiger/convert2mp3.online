---
// Cookie Consent Banner - Required for AdSense/GDPR compliance
---

<div
  id="cookie-consent"
  class="fixed bottom-0 left-0 right-0 z-[100] transform translate-y-full transition-transform duration-500 ease-out"
  role="dialog"
  aria-label="Cookie consent"
>
  <div class="bg-slate-900 border-t border-white/10 shadow-2xl shadow-black/50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
        <div class="flex-1">
          <p class="text-sm text-white/70 leading-relaxed">
            We use cookies to enhance your experience and serve personalized ads through Google AdSense. By clicking "Accept All," you consent to our use of cookies as described in our
            <a href="/privacy" class="text-violet-400 hover:text-violet-300 underline">Privacy Policy</a>.
            You can manage your preferences or opt out at any time.
          </p>
        </div>
        <div class="flex items-center gap-3 flex-shrink-0">
          <button
            id="cookie-reject"
            class="px-4 py-2 text-sm font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 rounded-lg transition-colors"
          >
            Essential Only
          </button>
          <button
            id="cookie-accept"
            class="px-4 py-2 text-sm font-medium text-white bg-violet-600 hover:bg-violet-500 rounded-lg transition-colors"
          >
            Accept All
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function initCookieConsent() {
    const banner = document.getElementById("cookie-consent");
    const acceptBtn = document.getElementById("cookie-accept");
    const rejectBtn = document.getElementById("cookie-reject");

    if (!banner || !acceptBtn || !rejectBtn) return;

    const consent = localStorage.getItem("cookie-consent");

    if (!consent) {
      // Show banner after a brief delay
      setTimeout(() => {
        banner.classList.remove("translate-y-full");
        banner.classList.add("translate-y-0");
      }, 1000);
    } else if (consent === "accepted") {
      enableAdSense();
    }

    acceptBtn.addEventListener("click", () => {
      localStorage.setItem("cookie-consent", "accepted");
      hideBanner();
      enableAdSense();
    });

    rejectBtn.addEventListener("click", () => {
      localStorage.setItem("cookie-consent", "essential");
      hideBanner();
    });

    function hideBanner() {
      banner.classList.remove("translate-y-0");
      banner.classList.add("translate-y-full");
    }

    function enableAdSense() {
      // Enable personalized ads when consent is given
      window.adsbygoogle = window.adsbygoogle || [];
    }
  }

  // Run on initial load
  initCookieConsent();

  // Re-run on Astro page transitions
  document.addEventListener("astro:after-swap", initCookieConsent);
</script>
